
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thrust Fund Countdown</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: white; padding-top: 40px; }
    canvas { display: block; margin: 0 auto; }
    #countdown { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 36px; font-weight: bold; }
    .wrapper { position: relative; width: 300px; height: 300px; margin: 0 auto; }
    #message { margin-top: 30px; font-size: 18px; padding: 0 30px; }
  </style>
</head>
<body>
  <div class="wrapper">
    <canvas id="timerCanvas" width="300" height="300"></canvas>
    <div id="countdown">40:00:00</div>
  </div>
  <div id="message">You've just started your fast!</div>

  <audio id="victorySound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_603cd196a5.mp3" preload="auto"></audio>

  <script>
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return parseInt(params.get(name)) || 144000; // fallback to 40hr if no param
    }

    const canvas = document.getElementById('timerCanvas');
    const ctx = canvas.getContext('2d');
    const countdownEl = document.getElementById("countdown");
    const messageEl = document.getElementById("message");

    const totalSeconds = getQueryParam("duration");
    let timeLeft = totalSeconds;
    let timer;
    let sparkleFrame = 0;
    let animationFrame;
    const particles = [];

    const radius = 120;
    const lineWidth = 40;
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;

    const gradientCanvas = document.createElement('canvas');
    gradientCanvas.width = 300;
    gradientCanvas.height = 300;
    const gctx = gradientCanvas.getContext('2d');

    const gradient = gctx.createConicGradient(-0.5 * Math.PI, centerX, centerY);
    gradient.addColorStop(0, 'red');
    gradient.addColorStop(0.33, 'orange');
    gradient.addColorStop(0.66, 'yellow');
    gradient.addColorStop(1, 'green');

    gctx.beginPath();
    gctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    gctx.lineWidth = lineWidth;
    gctx.strokeStyle = gradient;
    gctx.stroke();

    const gradientImage = new Image();
    gradientImage.src = gradientCanvas.toDataURL();

    function formatTime(seconds) {
      const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
      const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      const secs = String(seconds % 60).padStart(2, '0');
      return `${hrs}:${mins}:${secs}`;
    }

    function drawArc(progress) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
      ctx.lineWidth = lineWidth;
      ctx.strokeStyle = '#eee';
      ctx.stroke();

      ctx.save();
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius + lineWidth / 2, -0.5 * Math.PI, -0.5 * Math.PI - 2 * Math.PI * progress, true);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(gradientImage, 0, 0);
      ctx.restore();
    }

    function triggerCelebration() {
      sparkleFrame = 0;
      for (let i = 0; i < 50; i++) {
        particles.push({
          x: centerX,
          y: centerY,
          vx: (Math.random() - 0.5) * 4,
          vy: (Math.random() - 0.5) * 4,
          size: Math.random() * 3 + 1,
          alpha: 1
        });
      }
      const sound = document.getElementById('victorySound');
      if (sound) sound.play();
      drawFinalScene();
    }

    function drawFinalScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.shadowBlur = 40;
      ctx.shadowColor = '#ffd700';

      const goldGradient = ctx.createRadialGradient(centerX - 30, centerY - 30, 10, centerX, centerY, radius);
      goldGradient.addColorStop(0, '#fffacd');
      goldGradient.addColorStop(0.3, '#ffd700');
      goldGradient.addColorStop(0.8, '#daa520');
      goldGradient.addColorStop(1, '#b8860b');

      ctx.beginPath();
      ctx.arc(centerX, centerY, radius - lineWidth / 2, 0, 2 * Math.PI);
      ctx.fillStyle = goldGradient;
      ctx.fill();
      ctx.shadowBlur = 0;

      const scale = 1 + 0.05 * Math.sin(sparkleFrame * 0.1);
      ctx.save();
      ctx.translate(centerX, centerY);
      ctx.scale(scale, scale);
      ctx.fillStyle = 'black';
      ctx.font = 'bold 20px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.globalAlpha = Math.min(1, sparkleFrame / 60);
      ctx.fillText("YOU DID IT!", 0, 0);
      ctx.restore();
      ctx.globalAlpha = 1;

      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        ctx.fillStyle = `rgba(255,255,255,${p.alpha})`;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, 2 * Math.PI);
        ctx.fill();
        p.x += p.vx;
        p.y += p.vy;
        p.size *= 0.98;
        p.vx *= 0.98;
        p.vy *= 0.98;
        p.alpha *= 0.96;
        if (p.alpha < 0.05 || p.size < 0.5) particles.splice(i, 1);
      }

      if (Math.random() < 0.2) {
        particles.push({
          x: centerX, y: centerY,
          vx: (Math.random() - 0.5) * 4,
          vy: (Math.random() - 0.5) * 4,
          size: Math.random() * 3 + 1,
          alpha: 1
        });
      }

      sparkleFrame++;
      animationFrame = requestAnimationFrame(drawFinalScene);
    }

    function updateTimer() {
      if (timeLeft === 0) {
        clearInterval(timer);
        countdownEl.textContent = "";
        messageEl.innerHTML = "<strong>You've completed your fast! Welcome to the transformation.</strong>";
        window.ReactNativeWebView.postMessage("timerComplete");
        triggerCelebration();
        return;
      }

      const progress = (totalSeconds - timeLeft) / totalSeconds;
      drawArc(progress);
      countdownEl.textContent = formatTime(timeLeft);
      timeLeft--;
    }

    gradientImage.onload = function () {
      updateTimer();
      timer = setInterval(updateTimer, 1000);
    };
  </script>
</body>
</html>
